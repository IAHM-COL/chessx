#!/bin/sh
DIR=${0%/*}
echo "Build archive from ${DIR} in ${DIR}/../Packages/"

VERSION=$(awk '
    BEGIN { major="0"; minor="0"; patch="0" }
    /#define VERSION_MAJOR/ {gsub(/[^0-9]/, "", $3); major=$3; }
    /#define VERSION_MINOR/ {gsub(/[^0-9]/, "", $3); minor=$3; }
    /#define REVISION/ {gsub(/[^0-9]/, "", $3); patch=$3; }
    END {
        print major "." minor "." patch
    }' ${DIR}/../src/database/version.h)
    
echo "Building archive for version ${VERSION}"
    
CNAME=chessx-${VERSION}
__SCRIPTDIR="${0%/*}"

if [ -d "$CNAME" ]; then
   gtar -czf "${CNAME}.tgz" --exclude-from=$__SCRIPTDIR/tar_exclude.txt ./chessx
   mv "${CNAME}.tgz" ${DIR}/../Packages/
   echo "Ready"
else
  echo "Directory not found"
fi



